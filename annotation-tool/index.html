<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>多功能圖片標註工具 (v6.5)</title>
    <!-- 1. 引入外部 CSS 檔案 -->
    <link rel="stylesheet" href="annotation-tool.css">
</head>
<body>
<div id="app-container">
    <h2>多功能圖片標註工具 (v6.5)</h2>
    <div class="toolbar">
        <!-- 檔案操作 -->
        <input type="file" id="imgInput" accept="image/*, application/json" style="display: none;">
        <button id="clearBtn" class="toolbar-btn" title="清除畫布/新增圖片"></button>
        <div class="separator"></div>
        
        <!-- 歷史紀錄 -->
        <button id="undoBtn" class="toolbar-btn" title="復原 (Ctrl+Z)"></button>
        <button id="redoBtn" class="toolbar-btn" title="取消復原 (Ctrl+Y)"></button>
        <div class="separator"></div>
        
        <!-- 新功能：裁切 -->
        <button id="cropBtn" class="toolbar-btn" title="裁切圖片"></button>
        <div class="separator"></div>

        <!-- 標註工具 -->
        <button id="numberBtn" class="toggle-btn">123</button>
        <button id="ellipseBtn" class="toolbar-btn" title="橢圓 (按住 Shift 畫正圓)"></button>
        <button id="rectBtn" class="toolbar-btn" title="矩形 (按住 Shift 畫正方形)"></button>
        <!-- FIX: Added 'toolbar-btn' class here -->
        <button id="arrowBtn" class="toolbar-btn arrow-btn"></button>
        <button id="highlighterBtn" class="toolbar-btn" title="螢光筆"></button>
        <!-- FIX: Added 'toolbar-btn' class here -->
        <button id="textBtn" class="toolbar-btn text-btn"></button>
        <label><input type="color" id="colorPicker" value="#ff0000" title="標註顏色"></label>
        <div class="separator"></div>
        
        <!-- 縮放控制 -->
        <button id="zoomOutBtn" class="toolbar-btn" title="縮小"></button>
        <button id="zoomInBtn" class="toolbar-btn" title="放大"></button>
        <button id="zoomFitBtn" class="toolbar-btn" title="符合畫面大小"></button>
        <div class="separator"></div>
        
        <!-- 儲存與匯出 -->
        <button id="saveProjectBtn" class="toolbar-btn" title="儲存專案 (.json)"></button>
        <button id="copyImageBtn" class="toolbar-btn" title="複製到剪貼簿"></button>
        <button id="downloadImageBtn" class="toolbar-btn" title="下載圖片 (.png)"></button>
    </div>

    <div id="canvas-container" class="empty">
        <div id="image-placeholder">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
            <span>將圖片或專案檔 (.json) 拖曳至此<br>或點擊選擇檔案</span>
        </div>
        <canvas id="canvas"></canvas>
        
        <!-- 裁切工具列 (預設隱藏) -->
        <div id="crop-toolbar">
            <button id="applyCropBtn" title="確認裁切"></button>
            <button id="cancelCropBtn" title="取消"></button>
        </div>
        
        <!-- 文字輸入框 (預設隱藏) -->
        <div id="textInputContainer">
            <textarea id="textInputArea" rows="1" placeholder="輸入文字..."></textarea>
            <div class="text-input-controls">
                <button id="textConfirmBtn" title="確認 (Shift+Enter)">✔</button>
                <button id="textCancelBtn" title="取消 (Esc)">✖</button>
            </div>
        </div>
        
        <!-- 彈出式選單 (預設隱藏) -->
        <input type="number" id="moveNumberInput" min="1">
        <div id="circleMenu"></div>
        <div id="textMenu"></div>
        <div id="arrowMenu"></div>
    </div>

    <p>
        - <b>使用提示:</b> 按住 <b>空白鍵</b> 或 <b>雙指</b> 可拖曳平移。使用 <b>滑鼠滾輪</b>、<b>雙指縮放</b> 或 <b>+/- 按鈕</b> 可縮放畫面。<br>
        - <b>行動裝置:</b> <b>長按</b> 工具按鈕 (123, T, ➔) 或數字標註可開啟對應選單。<br>
        - <b>更新日誌 (v6.5):</b> 新增裁切功能與優化文字輸入框定位。<br>
        - <b>先前更新：</b> 行動裝置支援、動態圖片高度、復原/取消復原等功能。
    </p>

    <!-- START: 新增的聯絡我們按鈕和對話框 -->
    <button id="contactBtn" class="toolbar-btn contact-btn" title="有問題？聯絡我們"></button>
    <!-- END: 新增的聯絡我們按鈕和對話框 -->

</div>

<!-- START: 新增的彈出式對話框結構 (放在 #app-container 外層，確保層級最高) -->
<div id="contactModalOverlay" class="modal-overlay">
    <div class="modal-content">
        <button id="closeModalBtn" class="modal-close-btn">&times;</button>
        <h3>有任何問題或意見嗎？</h3>
        <p>請填寫下方表格，我們會盡快與您聯繫。</p>
        <div class="form-wrapper">
            <!-- 將您的 Google 表單嵌入程式碼的 src 貼到這裡 -->
            <!-- 確保 embedded=true 在連結中 -->
            <iframe id="googleFormIframe" src="https://docs.google.com/forms/d/e/1FAIpQLScin9rNo5K6F8rHapCGsdBs8wtEDm3W-svCQAvpFnzgdiDfaQ/viewform?embedded=true" frameborder="0" marginheight="0" marginwidth="0">載入中…</iframe>
        </div>
    </div>
</div>
<!-- END: 新增的彈出式對話框結構 -->

<!-- 2. 引入模組化的 JavaScript 主檔案 -->
<script type="module" src="js/app.js"></script>

</body>
</html>